services:
  netmon:
    build: ./app
    container_name: netmon
    restart: unless-stopped
    network_mode: host
    cap_add: [NET_RAW, NET_ADMIN]
    environment: [TZ=Europe/Stockholm]
    tmpfs: [/opt/netmon/db:size=20m]
    volumes:
      - netmon-www:/var/www/html/netmon
      # Persist SQLite DB on the host
      - ./data:/opt/netmon/backups

  web:
    build: ./web
    container_name: netmon_web
    restart: unless-stopped
    ports: [8080:80]
    volumes: [netmon-www:/usr/share/nginx/html/netmon:ro]

volumes:
  netmon-www:
    driver: local
    driver_opts:
      type: tmpfs
      device: tmpfs
      o: size=20m
